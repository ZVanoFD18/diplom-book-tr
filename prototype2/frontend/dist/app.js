!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=289)}({204:function(e,n,t){var o=t(297);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},289:function(e,n,t){e.exports=t(833)},290:function(e,n,t){var o=t(291);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},291:function(e,n,t){},292:function(e,n){e.exports=function(e){var n="undefined"!=typeof window&&window.location;if(!n)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var t=n.protocol+"//"+n.host,o=t+n.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,n){var r,a=n.trim().replace(/^"(.*)"$/,function(e,n){return n}).replace(/^'(.*)'$/,function(e,n){return n});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(r=0===a.indexOf("//")?a:0===a.indexOf("/")?t+a:o+a.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")})}},293:function(e,n,t){var o=t(294);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},294:function(e,n,t){},295:function(e,n,t){var o=t(296);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},296:function(e,n,t){},297:function(e,n,t){},298:function(e,n,t){var o=t(299);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},299:function(e,n,t){},300:function(e,n,t){var o=t(301);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},301:function(e,n,t){},302:function(e,n,t){var o=t(303);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},303:function(e,n,t){},304:function(e,n,t){var o=t(305);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},305:function(e,n,t){},306:function(e,n,t){var o=t(307);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},307:function(e,n,t){},308:function(e,n,t){var o=t(309);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},309:function(e,n,t){},310:function(e,n,t){var o=t(311);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},311:function(e,n,t){},312:function(e,n,t){var o=t(313);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},313:function(e,n,t){},314:function(e,n,t){var o=t(315);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},315:function(e,n,t){},316:function(e,n,t){var o=t(317);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},317:function(e,n,t){},318:function(e,n,t){var o=t(319);"string"==typeof o&&(o=[[e.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t(32)(o,r);o.locals&&(e.exports=o.locals)},319:function(e,n,t){},32:function(e,n,t){var o,r,a={},i=(o=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=o.apply(this,arguments)),r}),u=function(e){var n={};return function(e,t){if("function"==typeof e)return e();if(void 0===n[e]){var o=function(e,n){return n?n.querySelector(e):document.querySelector(e)}.call(this,e,t);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(e){o=null}n[e]=o}return n[e]}}(),c=null,l=0,s=[],d=t(292);function f(e,n){for(var t=0;t<e.length;t++){var o=e[t],r=a[o.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](o.parts[i]);for(;i<o.parts.length;i++)r.parts.push(h(o.parts[i],n))}else{var u=[];for(i=0;i<o.parts.length;i++)u.push(h(o.parts[i],n));a[o.id]={id:o.id,refs:1,parts:u}}}}function p(e,n){for(var t=[],o={},r=0;r<e.length;r++){var a=e[r],i=n.base?a[0]+n.base:a[0],u={css:a[1],media:a[2],sourceMap:a[3]};o[i]?o[i].parts.push(u):t.push(o[i]={id:i,parts:[u]})}return t}function y(e,n){var t=u(e.insertInto);if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var o=s[s.length-1];if("top"===e.insertAt)o?o.nextSibling?t.insertBefore(n,o.nextSibling):t.appendChild(n):t.insertBefore(n,t.firstChild),s.push(n);else if("bottom"===e.insertAt)t.appendChild(n);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=u(e.insertAt.before,t);t.insertBefore(n,r)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var n=s.indexOf(e);n>=0&&s.splice(n,1)}function m(e){var n=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var o=function(){0;return t.nc}();o&&(e.attrs.nonce=o)}return v(n,e.attrs),y(e,n),n}function v(e,n){Object.keys(n).forEach(function(t){e.setAttribute(t,n[t])})}function h(e,n){var t,o,r,a;if(n.transform&&e.css){if(!(a="function"==typeof n.transform?n.transform(e.css):n.transform.default(e.css)))return function(){};e.css=a}if(n.singleton){var i=l++;t=c||(c=m(n)),o=S.bind(null,t,i,!1),r=S.bind(null,t,i,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(t=function(e){var n=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",v(n,e.attrs),y(e,n),n}(n),o=function(e,n,t){var o=t.css,r=t.sourceMap,a=void 0===n.convertToAbsoluteUrls&&r;(n.convertToAbsoluteUrls||a)&&(o=d(o));r&&(o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var i=new Blob([o],{type:"text/css"}),u=e.href;e.href=URL.createObjectURL(i),u&&URL.revokeObjectURL(u)}.bind(null,t,n),r=function(){g(t),t.href&&URL.revokeObjectURL(t.href)}):(t=m(n),o=function(e,n){var t=n.css,o=n.media;o&&e.setAttribute("media",o);if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}.bind(null,t),r=function(){g(t)});return o(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;o(e=n)}else r()}}e.exports=function(e,n){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(n=n||{}).attrs="object"==typeof n.attrs?n.attrs:{},n.singleton||"boolean"==typeof n.singleton||(n.singleton=i()),n.insertInto||(n.insertInto="head"),n.insertAt||(n.insertAt="bottom");var t=p(e,n);return f(t,n),function(e){for(var o=[],r=0;r<t.length;r++){var i=t[r];(u=a[i.id]).refs--,o.push(u)}e&&f(p(e,n),n);for(r=0;r<o.length;r++){var u;if(0===(u=o[r]).refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete a[u.id]}}}};var b,w=(b=[],function(e,n){return b[e]=n,b.filter(Boolean).join("\n")});function S(e,n,t,o){var r=t?"":o.css;if(e.styleSheet)e.styleSheet.cssText=w(n,r);else{var a=document.createTextNode(r),i=e.childNodes;i[n]&&e.removeChild(i[n]),i.length?e.insertBefore(a,i[n]):e.appendChild(a)}}},833:function(n,t,o){"use strict";o.r(t);o(290);function r(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getXhr",value:function(){var e;try{e=new XMLHttpRequest}catch(n){try{e=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(n){try{e=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(n){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw new Error("This browser does not support XMLHttpRequest.")}}}}}return e}}],(t=null)&&r(n.prototype,t),o&&r(n,o),e}();function i(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getBookFromText",value:function(e){var n={lang:void 0,image:void 0,title:[],sections:[]},t={title:[],p:[]},o=Object.assign({},n);o.title=[],o.sections=[];var r=P.Xml.getXMLFromString(e);if("utf-8"!==r.xmlEncoding.toLowerCase())throw new Error("Кодировка книги не поддерживается.");o.lang=r.querySelector("description>title-info>lang").innerHTML;var a=r.querySelector("description>title-info>book-title").innerHTML;return a?o.title.push(a):r.querySelectorAll("body>title>p").forEach(function(e){o.title.push(e.innerHTML)}),o.image=r.querySelector("description>title-info>coverpage>image"),o.image||(o.image=r.querySelector("body>image")),o.image&&(o.image=function(e){var n=r.querySelector('binary[id="'+e.substr(1)+'"');if(n)return n.innerHTML;return}(o.image.getAttribute("l:href"))),r.querySelector("body").querySelectorAll("section").forEach(function(e){var n=Object.assign({},t);n.title=[],n.p=[],e.querySelector("title").querySelectorAll("p").forEach(function(e){n.title.push(e.innerHTML)}),e.querySelectorAll("p").forEach(function(e){var t="";e.childNodes.forEach(function(e){3===e.nodeType&&(t+=e.textContent)}),n.p.push(t)}),o.sections.push(n)}),o}}],(t=null)&&i(n.prototype,t),o&&i(n,o),e}();function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getTranslateConverted",value:function(e){var n={wordLang:void 0,word:void 0,translate:void 0,score:void 0};return n.wordLang=e.data[2],n.word=e.data[0][0][1],n.translate=e.data[0][0][0],n.score=e.data[6],n}},{key:"translate",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";return new Promise(function(o,r){var a="https://translate.googleapis.com/translate_a/single?client=gtx&sl="+t+"&tl="+e+"&dt=t&q="+encodeURI(n);fetch(a).then(function(e){e.json().then(function(e){o({word:e[0][0][0],data:e})},r)},r)})}},{key:"translateXhr",value:function(e){if("object"!==c(e))throw new Error("options - не объект");var n=new XMLHttpRequest,t=new FormData;t.append("client","gtx"),t.append("sl","auto"),t.append("dt","t"),t.append("dt","bd"),t.append("dj","1"),t.append("tl","ru"),t.append("text",e.word);var o="https://translate.googleapis.com/translate_a/single",r=o+"?",a=!0,i=!1,u=void 0;try{for(var l,s=t.entries()[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var d=l.value;r+=("?"===r.substr(-1,1)?"":"&")+encodeURIComponent(d[0])+"="+encodeURIComponent(d[1])}}catch(e){i=!0,u=e}finally{try{a||null==s.return||s.return()}finally{if(i)throw u}}n.open("GET",r),n.withCredentials=!0,n.setRequestHeader("Destination",o),n.setRequestHeader("Access-Control-Allow-Headers","*"),n.send(t),n.upload.onload=function(){alert("aaa")},n.addEventListener("readystatechange",function(){if(4===n.readyState){n.getResponseHeader("Content-Disposition"),n.getResponseHeader("Content-Type");alert('@TODO: Как читать ответ, который приходит в заголовке <content-disposition: attachment; filename="f.txt">'),n.upload.onload=function(){alert("aaa")}}})}}],(t=null)&&l(n.prototype,t),o&&l(n,o),e}();function d(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",encode:function(e){var n="";do{n=this.chars[e%62]+n}while(e=Math.floor(e/62));return n},decode:function(e){for(var n,t=e.length,o=0,r=0;t--;)(n=this.chars.indexOf(e[t]))&&(r+=n*Math.pow(62,o)),++o;return r}},p=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"hashCode",value:function(e){var n=0;if(0==e.length)return n;for(var t=0;t<e.length;t++){n=(n<<5)-n+e.charCodeAt(t),n&=n}return n=(n=Math.abs(n)).toString(16)}},{key:"md5",value:function(e){return function(e){for(var n,t="0123456789ABCDEF",o="",r=0;r<e.length;r++)n=e.charCodeAt(r),o+=t.charAt(n>>>4&15)+t.charAt(15&n);return o}(function(e){for(var n="",t=0;t<32*e.length;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}(function(e,n){e[n>>5]|=128<<n%32,e[14+(n+64>>>9<<4)]=n;for(var u=1732584193,c=-271733879,l=-1732584194,s=271733878,d=0;d<e.length;d+=16){var f=u,p=c,y=l,g=s;c=a(c=a(c=a(c=a(c=r(c=r(c=r(c=r(c=o(c=o(c=o(c=o(c=t(c=t(c=t(c=t(c,l=t(l,s=t(s,u=t(u,c,l,s,e[d+0],7,-680876936),c,l,e[d+1],12,-389564586),u,c,e[d+2],17,606105819),s,u,e[d+3],22,-1044525330),l=t(l,s=t(s,u=t(u,c,l,s,e[d+4],7,-176418897),c,l,e[d+5],12,1200080426),u,c,e[d+6],17,-1473231341),s,u,e[d+7],22,-45705983),l=t(l,s=t(s,u=t(u,c,l,s,e[d+8],7,1770035416),c,l,e[d+9],12,-1958414417),u,c,e[d+10],17,-42063),s,u,e[d+11],22,-1990404162),l=t(l,s=t(s,u=t(u,c,l,s,e[d+12],7,1804603682),c,l,e[d+13],12,-40341101),u,c,e[d+14],17,-1502002290),s,u,e[d+15],22,1236535329),l=o(l,s=o(s,u=o(u,c,l,s,e[d+1],5,-165796510),c,l,e[d+6],9,-1069501632),u,c,e[d+11],14,643717713),s,u,e[d+0],20,-373897302),l=o(l,s=o(s,u=o(u,c,l,s,e[d+5],5,-701558691),c,l,e[d+10],9,38016083),u,c,e[d+15],14,-660478335),s,u,e[d+4],20,-405537848),l=o(l,s=o(s,u=o(u,c,l,s,e[d+9],5,568446438),c,l,e[d+14],9,-1019803690),u,c,e[d+3],14,-187363961),s,u,e[d+8],20,1163531501),l=o(l,s=o(s,u=o(u,c,l,s,e[d+13],5,-1444681467),c,l,e[d+2],9,-51403784),u,c,e[d+7],14,1735328473),s,u,e[d+12],20,-1926607734),l=r(l,s=r(s,u=r(u,c,l,s,e[d+5],4,-378558),c,l,e[d+8],11,-2022574463),u,c,e[d+11],16,1839030562),s,u,e[d+14],23,-35309556),l=r(l,s=r(s,u=r(u,c,l,s,e[d+1],4,-1530992060),c,l,e[d+4],11,1272893353),u,c,e[d+7],16,-155497632),s,u,e[d+10],23,-1094730640),l=r(l,s=r(s,u=r(u,c,l,s,e[d+13],4,681279174),c,l,e[d+0],11,-358537222),u,c,e[d+3],16,-722521979),s,u,e[d+6],23,76029189),l=r(l,s=r(s,u=r(u,c,l,s,e[d+9],4,-640364487),c,l,e[d+12],11,-421815835),u,c,e[d+15],16,530742520),s,u,e[d+2],23,-995338651),l=a(l,s=a(s,u=a(u,c,l,s,e[d+0],6,-198630844),c,l,e[d+7],10,1126891415),u,c,e[d+14],15,-1416354905),s,u,e[d+5],21,-57434055),l=a(l,s=a(s,u=a(u,c,l,s,e[d+12],6,1700485571),c,l,e[d+3],10,-1894986606),u,c,e[d+10],15,-1051523),s,u,e[d+1],21,-2054922799),l=a(l,s=a(s,u=a(u,c,l,s,e[d+8],6,1873313359),c,l,e[d+15],10,-30611744),u,c,e[d+6],15,-1560198380),s,u,e[d+13],21,1309151649),l=a(l,s=a(s,u=a(u,c,l,s,e[d+4],6,-145523070),c,l,e[d+11],10,-1120210379),u,c,e[d+2],15,718787259),s,u,e[d+9],21,-343485551),u=i(u,f),c=i(c,p),l=i(l,y),s=i(s,g)}return Array(u,c,l,s)}(function(e){for(var n=Array(e.length>>2),t=0;t<n.length;t++)n[t]=0;for(t=0;t<8*e.length;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}(e),8*e.length))).toLowerCase();function n(e,n,t,o,r,a){return i(function(e,n){return e<<n|e>>>32-n}(i(i(n,e),i(o,a)),r),t)}function t(e,t,o,r,a,i,u){return n(t&o|~t&r,e,t,a,i,u)}function o(e,t,o,r,a,i,u){return n(t&r|o&~r,e,t,a,i,u)}function r(e,t,o,r,a,i,u){return n(t^o^r,e,t,a,i,u)}function a(e,t,o,r,a,i,u){return n(o^(t|~r),e,t,a,i,u)}function i(e,n){var t=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(t>>16)<<16|65535&t}}},{key:"Base62",get:function(){return f}}],(t=null)&&d(n.prototype,t),o&&d(n,o),e}();function y(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var g=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"loadTextFromInputFile",value:function(e){return new Promise(function(n,t){var o=e.files,r=new FileReader;r.onload=function(e){n(e.target.result)},r.onerror=function(){t()},r.readAsText(o[0])})}}],(t=null)&&y(n.prototype,t),o&&y(n,o),e}();function m(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var v=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"isDbExists",value:function(e){return new Promise(function(n,t){var o,r=indexedDB;try{(o=r.webkitGetDatabaseNames()).onsuccess=function(o){~[].slice.call(o.target.result).indexOf(e)?n(!0):t(!1)}}catch(a){(o=r.open(e)).onsuccess=function(){o.result.close(),n(!0)},o.onupgradeneeded=function(e){e.target.transaction.abort(),t(!1)}}})}}],(t=null)&&m(n.prototype,t),o&&m(n,o),e}();function h(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var b=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"addDebug",value:function(e,n){console.log("@DEBUG:",{msg:e,place:n||(new Error).stack})}},{key:"addTodo",value:function(e,n){console.log("@TODO:",{msg:e,place:n||(new Error).stack})}}],(t=null)&&h(n.prototype,t),o&&h(n,o),e}();function w(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var S=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"apply",value:function(e,n,t){for(var o in t=t||!1,n)P.isObject(n[o])?t?P.Obj.apply(e[o],n[o]):e[o]=Object.assign({},n[o]):e[o]=n[o]}},{key:"replaceMembers",value:function(e,n,t){for(var o in t=void 0===t||t,n)if(o in e)e[o]=n[o];else if(t)throw new Error('Поле "'+o+'" не найдено в целевом объекте');return e}},{key:"getFieldsAsArray",value:function(e,n){var t=[];return e.forEach(function(e){P.isObject(e)&&n in e&&t.push(e[n])}),t}},{key:"getObjectFromArray",value:function(e,n,t){for(var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=0,a=e.length;r<a;r++)if(e[r][n]===t)return e[r];return o}}],(t=null)&&w(n.prototype,t),o&&w(n,o),e}();function k(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var T={alphabette:{ENG:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'",RUS:"абвгдеёжзийклмнопрстуфхцчшщъыьэюяАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ1234567890"}},L=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getWords",value:function(e,n){for(var t=[],o="",r=!0,a=T.alphabette[e],i=0,u=n.length;i<u;i++){var c=n[i];a.indexOf(c)>=0?(r||(t.push(o),o="",r=!0),o+=c):(""!==o&&r&&(t.push(o),o=""),"?!.".indexOf(c)>=0?(""!==o&&(t.push(o),o=""),t.push(c)):",-".indexOf(c)>=0?(""!==o&&(t.push(o),o=""),t.push(c)):" ".indexOf(c)>=0?""!==o&&(t.push(o),o=""):(o+=c,r=!1))}return""!==o&&t.push(o),t}}],(t=null)&&k(n.prototype,t),o&&k(n,o),e}();function A(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var E=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"transformXslt",value:function(e,n){if(window.ActiveXObject)return e.transformNode(n);if(window.XSLTProcessor){var t=new XSLTProcessor;t.importStylesheet(n);var o=t.transformToDocument(e);return(new XMLSerializer).serializeToString(o)}return alert("XML-transform not supported"),null}},{key:"getXMLFromString",value:function(e){var n;return window.ActiveXObject?((n=new ActiveXObject("Microsoft.XMLDOM")).async=!1,n.loadXML(e),n):window.DOMParser?(new DOMParser).parseFromString(e,"text/xml"):(alert("XML load not supported"),null)}}],(t=null)&&A(n.prototype,t),o&&A(n,o),e}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var P=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"emptyFn",value:function(){}},{key:"isArray",value:function(e){return Array.isArray(e)}},{key:"isBoolean",value:function(e){return"boolean"==typeof e}},{key:"isNumber",value:function(e){return"number"==typeof e&&isFinite(e)}},{key:"isObject",value:function(e){return"object"===C(e)}},{key:"isString",value:function(e){return"string"==typeof e}},{key:"isDefined",value:function(e){return void 0!==e}},{key:"isNull",value:function(e){return null===e}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isEmpty",value:function(n){return!!e.isDefined(n)&&(!!e.isString(n)&&""===n)}},{key:"Ajax",get:function(){return a}},{key:"Fb2",get:function(){return u}},{key:"Google",get:function(){return s}},{key:"Hash",get:function(){return p}},{key:"Io",get:function(){return g}},{key:"Idb",get:function(){return v}},{key:"Log",get:function(){return b}},{key:"Obj",get:function(){return S}},{key:"Text",get:function(){return L}},{key:"Xml",get:function(){return E}}],(t=null)&&O(n.prototype,t),o&&O(n,o),e}();o(293),o(295),o(204),o(298);function I(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var D={elNav:void 0,elNavIcon:void 0},j=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"init",value:function(){D.elNav=document.querySelector("nav.nav"),D.elNavIcon=document.querySelector(".nav-icon"),D.elNavIcon.addEventListener("click",this.onNavIconClick.bind(this)),D.elNav.addEventListener("click",this.onNavClick.bind(this))}},{key:"onNavIconClick",value:function(e){D.elNav.classList.remove("hidden"),D.elNav.classList.toggle("opened")}},{key:"onNavClick",value:function(e){var n=e.target.getAttribute("href");null!==n&&(this.go2section(n.substr(1)),D.elNav.classList.toggle("opened"))}},{key:"go2section",value:function(e){document.App.Component.Loadmask.show(document.App.localize("Навигация...")),setTimeout(function(){var n=document.getElementById("content").querySelectorAll("section");switch((n=[].slice.call(n)).forEach(function(e){e.classList.add("hidden")}),document.getElementById(e).classList.remove("hidden"),document.getElementById(e).scrollIntoView(),document.App.Component.Loadmask.hide(),e){case"setlang":document.App.Component.Setlang.display();break;case"study":document.App.Component.Study.display();break;case"library":document.App.Component.Library.display()}},50)}}],(t=null)&&I(n.prototype,t),o&&I(n,o),e}();o(300);function M(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var W={el:void 0,elLangGui:void 0,elLangGuiTplOptions:void 0,elLangStudy:void 0,elLangStudyTplOptions:void 0,isDisplayed:!1},H=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"init",value:function(){W.el=document.getElementById("setlang"),W.elLangGui=W.el.querySelector('select[name="lang-gui"]'),W.elLangGuiTplOptions=W.elLangGui.querySelector("option.tpl").cloneNode(!0),W.elLangGuiTplOptions.classList.remove("tpl"),W.elLangStudy=W.el.querySelector('select[name="lang-study"]'),W.elLangStudyTplOptions=W.elLangStudy.querySelector("option.tpl").cloneNode(!0),W.elLangStudyTplOptions.classList.remove("tpl"),W.el.querySelector(".button-submit").addEventListener("click",this.onSubmit.bind(this))}},{key:"display",value:function(){if(!this.isDisplayed){for(var e in W.elLangGui.innerHTML="",W.elLangStudy.innerHTML="",document.App.appEnv.languages){var n=W.elLangStudyTplOptions.cloneNode(!0);n.value=e,n.innerHTML=document.App.appEnv.languages[e],W.elLangGui.appendChild(n);var t=W.elLangStudyTplOptions.cloneNode(!0);t.value=e,t.innerHTML=document.App.appEnv.languages[e],W.elLangStudy.appendChild(t)}W.elLangGui.value=document.App.langGui,W.elLangStudy.value=document.App.langStudy,this.isDisplayed=!0}}},{key:"onSubmit",value:function(e){return e.preventDefault(),document.App.langGui=W.elLangGui.value,document.App.langStudy=W.elLangStudy.value,document.App.localizeGui(),document.App.Idb.KeyVal.LastSession.put({langGui:document.App.langGui,langStudy:document.App.langStudy,bookHash:void 0,bookPosition:void 0}).then(function(){document.App.Component.Nav.go2section("library")})}}],(t=null)&&M(n.prototype,t),o&&M(n,o),e}();o(302);function x(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var _=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"display",value:function(){return new Promise(function(e,n){dn.Idb.WordsStudy.getStat(document.App.langStudy).then(function(n){document.getElementById("statistic").querySelector(".stat-words-study").innerHTML=n.cntStudy||0,document.getElementById("statistic").querySelector(".stat-words-studied").innerHTML=n.cntStudied||0,e(!0)}).catch(function(n){P.Log.addDebug("Непредвиденная ошибка при получении статистики изучения слов"),document.getElementById("statistic").querySelector(".stat-words-study").innerHTML="???",document.getElementById("statistic").querySelector(".stat-words-studied").innerHTML="???",e(!1)})})}}],(t=null)&&x(n.prototype,t),o&&x(n,o),e}();function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,n){return!n||"object"!==R(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function B(e){var n="function"==typeof Map?new Map:void 0;return(B=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,o)}function o(){return N(e,arguments,F(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),q(o,e)})(e)}function N(e,n,t){return(N=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,n,t){var o=[null];o.push.apply(o,n);var r=new(Function.bind.apply(e,o));return t&&q(r,t.prototype),r}).apply(null,arguments)}function q(e,n){return(q=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var U=function(e){function n(){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),z(this,F(n).apply(this,arguments))}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&q(e,n)}(n,B(Error)),n}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,n){return!n||"object"!==G(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function K(e){var n="function"==typeof Map?new Map:void 0;return(K=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,o)}function o(){return Y(e,arguments,J(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),V(o,e)})(e)}function Y(e,n,t){return(Y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,n,t){var o=[null];o.push.apply(o,n);var r=new(Function.bind.apply(e,o));return t&&V(r,t.prototype),r}).apply(null,arguments)}function V(e,n){return(V=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Q=function(e){function n(){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),X(this,J(n).apply(this,arguments))}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&V(e,n)}(n,K(Error)),n}();function $(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Z=function(){function e(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),!P.isFunction(t))throw new Q('"callbackOnClick" - не задан');if(this.callbackOnClick=t,this.elContext=o||void 0,this.el=void 0,P.isString(n)){var r=document.querySelectorAll(el);if(r.length<1)throw new Q("Меню не найдено");if(r.length>1)throw new Q("Найдено более одного элемента меню");this.el=r[0]}else this.el=n;this.el.addEventListener("click",this.onClick.bind(this)),this.elContext&&this.elContext.addEventListener("click",this.elContext.bind(this))}var n,t,o;return n=e,(t=[{key:"setContext",value:function(e){return this.elContext=e,this}},{key:"onContextClick",value:function(){this.show()}},{key:"onClick",value:function(e){var n=e.target.closest(".menu-item");n&&(this.callbackOnClick(n,n.getAttribute("data-menu-item-id"),this.elContext),this.hide())}},{key:"showAt",value:function(e,n){this.el.style.left=e+"px",this.el.style.top=n+"px",this.el.classList.remove("hidden")}},{key:"hide",value:function(){this.el.classList.add("hidden")}}])&&$(n.prototype,t),o&&$(n,o),e}();function ee(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ne={Struct:{version:1,lang:void 0,title:void 0,image:void 0,hash:void 0,content:void 0}},te=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getByHash",value:function(e){return new Promise(function(n,t){document.App.Idb.getDb().then(function(o){var r=o.transaction(["Books"],"readonly").objectStore("Books").get(e);r.onsuccess=function(e){n(r.result)},r.onerror=function(e){document.Helper.Log.addDebug(e),t(new U(document.App.localize("Ошибка при поиске книги по хешу.")))}})})}},{key:"add",value:function(e,n,t,o){var r=this;return new Promise(function(a,i){var u,c=Object.assign({},ne.Struct);c=document.Helper.Obj.replaceMembers(c,{lang:e,title:n,image:t,hash:document.Helper.Hash.md5(o),content:o}),document.App.Idb.getDb().then(function(e){return u=e,r.getByHash(c.hash)}).then(function(e){return e||new Promise(function(e,n){var t=u.transaction(["Books"],"readwrite").objectStore("Books").put(c);t.onsuccess=function(n){e(c)},t.onerror=function(e){document.Helper.Log.addDebug(e),n(new U(document.App.localize("Не удалось добавить книгу в БД.")))}})}).then(function(e){a(e)}).catch(function(e){document.Helper.Log.addDebug(event),i(e)})})}},{key:"delete",value:function(e){return new Promise(function(n,t){document.App.Idb.getDb().then(function(e){return e}).then(function(o){var r=o.transaction(["Books"],"readwrite").objectStore("Books").delete(e);r.onsuccess=function(t){n(e)},r.onerror=function(e){document.Helper.Log.addDebug(e),t(new U(document.App.localize("Не удалось удалить книгу из БД.")))}}).catch(function(e){document.Helper.Log.addDebug(event),t(e)})})}},{key:"getAll",value:function(e){return(e=e||{}).filter=e.filter||{},document.Helper.isDefined(e.filter.lang)&&(e.filter.lang=document.App.Idb.getNormalizedLang(e.filter.lang)),new Promise(function(n,t){var o=[];document.App.Idb.getDb().then(function(t){var r=t.transaction(["Books"],"readonly").objectStore("Books").openCursor();r.onsuccess=function(t){var a=r.result;a?(document.Helper.isDefined(e.filter.lang)?e.filter.lang===a.value.lang&&o.push(a.value):o.push(a.value),a.continue()):n(o)}})})}}],(t=null)&&ee(n.prototype,t),o&&ee(n,o),e}();function oe(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var re={Struct:{version:1,langGui:void 0,langStudy:void 0,bookHash:void 0,bookPosition:void 0}},ae=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"get",value:function(){return new Promise(function(e,n){document.App.Idb.getDb().then(function(t){var o=t.transaction(["KeyVal"],"readwrite").objectStore("KeyVal").get(document.App.Idb.KeyVal.KEYS.LAST_SESSION);o.onsuccess=function(n){e(o.result)},o.onerror=function(e){n("Не удалось записать сессию в БД.")}})})}},{key:"put",value:function(e){var n=this;return new Promise(function(t,o){document.App.Idb.getDb().then(function(e){return e}).then(function(e){return new Promise(function(t,o){n.get().then(function(n){t({db:e,oldStruct:n})})})}).then(function(r){var a;a=r.oldStruct?r.oldStruct:Object.assign({},n.Struct),a=document.Helper.Obj.replaceMembers(a,e);var i=r.db.transaction(["KeyVal"],"readwrite").objectStore("KeyVal").put(a,document.App.Idb.KeyVal.KEYS.LAST_SESSION);i.onsuccess=function(e){t(i.result)},i.onerror=function(e){o(new U(document.App.localize("Не удалось записать сессию в БД.")))}})})}},{key:"Struct",get:function(){return re.Struct}}],(t=null)&&oe(n.prototype,t),o&&oe(n,o),e}();function ie(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ue={LAST_SESSION:"KEY_LAST_SESSION"},ce=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"get",value:function(e){return new Promise(function(n,t){document.App.Idb.getDb().then(function(o){var r=o.transaction(["KeyVal"],"readonly").objectStore("KeyVal").get(e);r.onsuccess=function(e){n(r.result)},r.onerror=function(e){t("Не удалось получить сессию из БД.")}})})}},{key:"LastSession",get:function(){return ae}},{key:"KEYS",get:function(){return ue}}],(t=null)&&ie(n.prototype,t),o&&ie(n,o),e}();function le(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var se={Struct:{version:1,lang:void 0,word:void 0,isStudy:void 0,isFinishedLang1ToLang2:void 0,isFinishedLang2ToLang1:void 0}},de=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getStruct",value:function(){return Object.assign({},se.Struct)}},{key:"getStructFromData",value:function(e){if(P.isDefined(e)){var n=this.getStruct();return n=P.Obj.replaceMembers(n,e,!1)}}},{key:"get",value:function(e,n){var t=this;return new Promise(function(o,r){return dn.Idb.getDb().then(function(a){var i=a.transaction(["WordsStudy"],"readonly").objectStore("WordsStudy").get([dn.Idb.getNormalizedLang(e),dn.Idb.getNormalizedWord(n)]);i.onsuccess=function(e){o(t.getStructFromData(e.target.result))},i.onerror=function(e){r()}})})}},{key:"getAllAsObject",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return P.Obj.replaceMembers({from:void 0,to:void 0},n),new Promise(function(t,o){var r={},a=0;dn.Idb.getDb().then(function(o){dn.Idb.getNormalizedLang(e);var i=o.transaction(["WordsStudy"],"readonly").objectStore("WordsStudy").index("i-lang"),u=IDBKeyRange.only([dn.Idb.getNormalizedLang(e)]),c=i.openCursor(u);c.onsuccess=function(e){var o=c.result;o?(P.isDefined(n.from)&&P.isDefined(n.to)?a>=n.from&&a<=n.to&&(r[o.value.word]=o.value):r[o.value.word]=o.value,++a,o.continue()):t(r)}}).catch(function(e){throw e})})}},{key:"put",value:function(e,n,t){var o,r=this;return t=t||{},e=e||t.lang,n=n||t.word,new Promise(function(a,i){if(!P.isString(e)||!P.isString(n))throw new Error("lang не задан");dn.Idb.getDb().then(function(t){return o=t,r.get(e,n)}).then(function(a){return new Promise(function(i,u){var c=a;c||(c=r.getStruct(),P.Obj.apply(c,{lang:dn.Idb.getNormalizedLang(e),word:dn.Idb.getNormalizedWord(n)})),P.Obj.apply(c,t);var l=o.transaction(["WordsStudy"],"readwrite").objectStore("WordsStudy").put(c);l.onsuccess=function(e){i(e.target.result)},l.onerror=function(e){u()}})}).then(function(e){a(e)}).catch(function(e){i(e)})})}},{key:"getForStudy",value:function(e,n){return new Promise(function(t,o){var r=[];dn.Idb.getDb().then(function(a){var i=a.transaction(["WordsStudy"],"readonly").objectStore("WordsStudy").index("i-lang-isStudy"),u=IDBKeyRange.only([dn.Idb.getNormalizedLang(e),dn.Idb.TRUE]),c=i.openCursor(u);c.onsuccess=function(e){var o=c.result;o?(r.push(o.value),r.length<n?o.continue():t(r)):t(r)},c.onerror=function(e){o("Не удалось получить слова по индексу.")}}).catch(function(e){P.Log.addDebug(e),o(e)})})}},{key:"getCountStudy",value:function(e,n){var t=dn.Idb.getNormalizedLang(e);return new Promise(function(e,o){dn.Idb.getDb().then(function(e){return new Promise(function(o,r){var a=e.transaction(["WordsStudy"],"readonly").objectStore("WordsStudy").index("i-lang-isStudy"),i=IDBKeyRange.only([t,n]),u=a.count(i);u.onsuccess=function(e){return new Promise(function(){o(u.result)})},u.onerror=function(e){r("Не удалось извлечь количество слов по индексу.")}})}).then(function(n){e(n)}).catch(function(e){o(e)})})}},{key:"getStat",value:function(e){var n=this,t={cntStudy:void 0,cntStudied:void 0};return new Promise(function(o,r){n.getCountStudy(e,dn.Idb.TRUE).then(function(o){return t.cntStudy=o,n.getCountStudy(e,dn.Idb.FALSE)}).then(function(e){t.cntStudied=e,o(t)}).catch(function(e){P.Log.addDebug(e),r(e)})})}},{key:"getCountForLang",value:function(e){return new Promise(function(n,t){dn.Idb.getDb().then(function(n){return new Promise(function(t,o){var r=n.transaction(["WordsStudy"],"readonly").objectStore("WordsStudy").index("i-lang"),a=IDBKeyRange.only([dn.Idb.getNormalizedLang(e)]),i=r.count(a);i.onsuccess=function(e){t(i.result)},i.onerror=function(e){P.Log.addDebug(e),o("Не удалось извлечь количество слов по индексу.")}})}).then(function(e){n(e)}).catch(function(e){t(e)})})}}],(t=null)&&le(n.prototype,t),o&&le(n,o),e}();function fe(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var pe={Struct:{version:1,langFrom:void 0,langTo:void 0,word:void 0,translate:void 0,score:void 0,insertAt:0}},ye=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getStruct",value:function(){return Object.assign({},pe.Struct)}},{key:"getStructFromData",value:function(e){if(document.Helper.isDefined(e)){var n=this.getStruct();return n=document.Helper.Obj.replaceMembers(n,e)}}},{key:"get",value:function(e,n,t){var o=this;return new Promise(function(r,a){return document.App.Idb.getDb().then(function(i){var u=i.transaction(["WordsTranslate"],"readonly").objectStore("WordsTranslate").index("i-langFrom-langTo-word").get([document.App.Idb.getNormalizedLang(e),document.App.Idb.getNormalizedLang(n),document.App.Idb.getNormalizedWord(t)]);u.onsuccess=function(e){r(o.getStructFromData(e.target.result))},u.onerror=function(e){a()}})})}},{key:"put",value:function(e,n,t,o,r){var a=this;return new Promise(function(i,u){document.App.Idb.getDb().then(function(c){var l=a.getStruct();document.Helper.Obj.apply(l,{langFrom:document.App.Idb.getNormalizedLang(e),langTo:document.App.Idb.getNormalizedLang(n),word:document.App.Idb.getNormalizedWord(t),translate:document.App.Idb.getNormalizedWord(o),score:r,insertAt:Date.now()});var s=c.transaction(["WordsTranslate"],"readwrite").objectStore("WordsTranslate").put(l);s.onsuccess=function(e){i(e.target.result)},s.onerror=function(e){u()}}).then(function(e){}).catch(function(e){u(e)})})}}],(t=null)&&fe(n.prototype,t),o&&fe(n,o),e}();function ge(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var me={TRUE:1,FALSE:0,_db:void 0},ve=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getBool",value:function(e){return e?this.TRUE:this.FALSE}},{key:"checkQuota",value:function(){window.webkitStorageInfo.queryUsageAndQuota(webkitStorageInfo.TEMPORARY,function(e,n){console.log("Used quota: "+e+", remaining quota: "+n)},function(e){console.log("Error",e)})}},{key:"getDb",value:function(){var e=this;return new Promise(function(n,t){e.open().then(function(e){n(me._db)}).catch(function(e){t(e)})})}},{key:"open",value:function(){var e=this;return new Promise(function(n,t){window.indexedDB||(window.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB);var o=indexedDB.open("main",2);o.onblocked=function(e){alert("Пожалуйста закройте все другие вкладки, открытые на этом сайте!")},o.onupgradeneeded=e.onUpgradeNeeded.bind(e),o.onsuccess=function(t){me._db=t.target.result,me._db.onversionchange=e.onVersionChange.bind(e),me._db.onclose=e.onClose.bind(e),n()},o.onerror=function(e){document.Helper.Log.addDebug("Ошибка! Проблема при открытии БД."),alert("Ошибка! Не могу открыть БД."),t()}})}},{key:"onClose",value:function(e){console.log("Idb/onClose",e)}},{key:"onUpgradeNeeded",value:function(e){var n,t=e.target.transaction,o=e.target.result;switch(e.oldVersion){case 0:n=o.createObjectStore("KeyVal"),(n=o.createObjectStore("Books",{keyPath:"hash",autoIncrement:!1})).createIndex("i-lang","lang"),n.createIndex("i-title","title",{unique:!1}),n=o.createObjectStore("WordsStudy",{keyPath:["lang","word"],autoIncrement:!1}),(n=t.objectStore("WordsStudy")).createIndex("i-lang",["lang"]),n.createIndex("i-lang-isStudy",["lang","isStudy"],{unique:!1});case 1:(n=o.createObjectStore("WordsTranslate",{keyPath:["langFrom","langTo","word"],autoIncrement:!1})).createIndex("i-langFrom",["langFrom"]),n.createIndex("i-langFrom-langTo",["langFrom","langTo"]),n.createIndex("i-langFrom-langTo-word",["langFrom","langTo","word"],{unique:!0})}}},{key:"onVersionChange",value:function(){me._db.close(),alert("Обновленние БД завершено. Пожалуйста обноите страницу!")}},{key:"getNormalizedLang",value:function(e){return e.toUpperCase()}},{key:"getNormalizedWord",value:function(e){return e.toLowerCase()}},{key:"Books",get:function(){return te}},{key:"KeyVal",get:function(){return ce}},{key:"WordsStudy",get:function(){return de}},{key:"WordsTranslate",get:function(){return ye}},{key:"TRUE",get:function(){return me.TRUE}},{key:"FALSE",get:function(){return me.FALSE}}],(t=null)&&ge(n.prototype,t),o&&ge(n,o),e}();function he(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var be={elContainer:void 0,el:void 0,elTplItem:void 0,bookMenu:void 0,books:[]},we=function(){function n(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n)}var t,o,r;return t=n,r=[{key:"init",value:function(){be.elContainer=Ee.getEl().querySelector(".library-books-container"),be.el=Ee.getEl().querySelector(".library-books-list"),be.el.addEventListener("click",this.onListClick.bind(this)),be.elTplItem=be.el.querySelector(".tpl.library-books-item"),be.elTplItem.classList.remove("tpl"),be.bookMenu=new Z(be.elContainer.querySelector(".library-book-menu"),this.onBookMenuClick.bind(this))}},{key:"_load",value:function(){return new Promise(function(e,n){be.books=[],document.App.Idb.Books.getAll({filter:{lang:document.App.langStudy}}).then(function(n){be.books=n,e()}).catch(function(e){n(new U(document.App.localize("Не удалось загрузить список книг из БД")))})})}},{key:"display",value:function(){this.clean(),be.books.forEach(function(e){var n=be.elTplItem.cloneNode(!0);n.querySelector(".library-books-hash").innerHTML=e.hash,n.querySelector(".library-books-lang-value").innerHTML=e.lang,n.querySelector(".library-books-title").innerHTML=e.title.concat("<br>");var t=e.image;t&&(n.querySelector(".library-books-image img").src="data:image/;base64,"+t),be.el.appendChild(n)})}},{key:"clean",value:function(){be.el.querySelectorAll(".library-books-item").forEach(function(e){be.el.removeChild(e)})}},{key:"loadAndDisplay",value:function(){var e=this;return new Promise(function(n,t){e._load().then(function(){e.display(),n()}).catch(function(e){t()})})}},{key:"onListClick",value:function(e){var n=e.target.closest(".library-books-item");n&&be.bookMenu.setContext(n).showAt(e.clientX,e.clientY)}},{key:"bookRead",value:function(e){e.classList.add("active"),setTimeout(function(){e.classList.remove("active")},2e3),document.App.bookToReadByHash(e.querySelector(".library-books-hash").innerHTML).then(function(){document.App.Component.Nav.go2section("read")}).catch(function(e){document.App.Component.WinMsg.show({title:document.App.localize("Уведомление."),message:e instanceof U?e.message:document.App.localize("Ошибка при попытке загрузить книгу из библиотеки")})})}},{key:"bookDelete",value:function(n){var t=this,o=n.querySelector(".library-books-hash").innerHTML;document.App.Component.Loadmask.show(document.App.localize("Удаление...")),ve.Books.delete(o).then(function(){document.App.Component.Loadmask.hide(),t.loadAndDisplay()}).catch(function(){document.App.Component.Loadmask.hide(),document.App.Component.WinMsg.show({title:document.App.localize("Ошибка."),message:e instanceof U?e.message:document.App.localize("Не удалось удалить книгу из библиотеки")})})}},{key:"onBookMenuClick",value:function(e,n,t){switch(n){case"read":this.bookRead(t);break;case"delete":this.bookDelete(t)}}}],(o=null)&&he(t.prototype,o),r&&he(t,r),n}();function Se(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ke=void 0,Te=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"init",value:function(){ke=Ee.getEl().querySelector('input[name="inpFile"]'),document.querySelector(".library-loadfromfile-button").addEventListener("click",this.onInputButtonClick.bind(this)),ke.addEventListener("change",this.onInputFileChange.bind(this))}},{key:"onInputButtonClick",value:function(){ke.click()}},{key:"onInputFileChange",value:function(e){document.App.Component.Loadmask.show(document.App.localize("Загрузка файла...")),document.Helper.Io.loadTextFromInputFile(e.srcElement).then(function(n){e.srcElement.value=null,document.App.Component.Loadmask.hide(),document.App.bookToRead(n,!0).then(function(){document.App.Component.Nav.go2section("read")}).catch(function(e){document.App.Component.Loadmask.hide(),document.App.Component.WinMsg.show({title:document.App.localize("Уведомление."),message:e instanceof U?e.message:document.App.localize("Ошибка при обработке книги")})}),document.App.Component.Library.isDisplayed=!1}).catch(function(e){document.App.Component.Loadmask.hide(),document.Helper.Log.addDebug(e)})}}],(t=null)&&Se(n.prototype,t),o&&Se(n,o),e}();o(304);function Le(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ae=void 0,Ee=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getEl",value:function(){return Ae}},{key:"init",value:function(){Ae=document.getElementById("library"),we.init(),Te.init()}},{key:"display",value:function(){we.loadAndDisplay().catch(function(e){document.Helper.Log.addDebug(e)}),!0}}],(t=null)&&Le(n.prototype,t),o&&Le(n,o),e}();o(306),o(308);function Ce(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Oe={el:void 0},Pe=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"init",value:function(){Oe.el=document.getElementById("win-word-actions")}},{key:"show",value:function(e){var n=this;return document.Helper.isObject(e)?document.Helper.isFunction(e.onStudied)?document.Helper.isFunction(e.onStudy)?document.Helper.isString(e.word)?document.Helper.isString(e.translate)||this.throwError('show/Не передан параметр "translate"'):this.throwError('show/Не передан параметр "word"'):this.throwError('show/Не передан параметр "onStudy"'):this.throwError('show/Не передан параметр "onStudied"'):this.throwError("show/Параметры не переданы"),Oe.el.querySelector(".word").innerHTML=e.word,Oe.el.querySelector(".translate").innerHTML=e.translate,Oe.el.onclick=function(t){t.preventDefault(),t.target.classList.contains("btn-cancel")?((e.onCancel||document.Helper.emptyFn)(),n.hide()):t.target.classList.contains("btn-studied")?(e.onStudied(),n.hide()):t.target.classList.contains("btn-study")&&(e.onStudy(),n.hide())},Oe.el.classList.remove("hidden"),this}},{key:"hide",value:function(){return Oe.el.classList.add("hidden"),this}},{key:"throwError",value:function(e){throw new Error("WinWordActions/"+e)}}],(t=null)&&Ce(n.prototype,t),o&&Ce(n,o),e}();function Ie(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var De={el:void 0},je=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"init",value:function(){De.el=document.getElementById("read"),De.el.addEventListener("click",this.onTextClick.bind(this)),Pe.init()}},{key:"displayBook",value:function(e){var n=this;return new Promise(function(t,o){var r=De.el,a={};document.App.Idb.WordsStudy.getAllAsObject(document.App.langStudy).then(function(e){a=e,i()}).catch(function(){i()});var i=function(){r.innerHTML="",e.sections.forEach(function(e){var t=document.createElement("h2");t.classList.add("read-text-title"),e.title.forEach(function(e){var o=document.createElement("p");o.classList.add("read-text-title-item"),document.Helper.Text.getWords(document.App.langStudy,e).forEach(function(e){var t=document.createElement("span");t.innerHTML=e;var r=document.App.getWordHash(e);t.classList.add("read-word"),t.classList.add("word-hash-"+r);var i=document.App.Idb.getNormalizedWord(e);i in a?a[i].isStudy?n.wordElMark(t,document.App.WORD_STATE.WORD_STATE_STUDY):n.wordElMark(t,document.App.WORD_STATE.WORD_STATE_STUDYED):n.wordElMark(t,document.App.WORD_STATE.WORD_STATE_UNKNOWN),o.appendChild(t)}),t.appendChild(o)}),r.appendChild(t);var o=document.createElement("p");o.classList.add("read-text-line"),e.p.forEach(function(e){var t=document.createElement("p");t.classList.add("read-text-line"),document.Helper.Text.getWords(document.App.langStudy,e).forEach(function(e){var o=document.createElement("span");o.innerHTML=e;var r=document.App.getWordHash(e);o.classList.add("read-word"),o.classList.add("word-hash-"+r);var i=document.App.Idb.getNormalizedWord(e);i in a?a[i].isStudy?n.wordElMark(o,document.App.WORD_STATE.WORD_STATE_STUDY):n.wordElMark(o,document.App.WORD_STATE.WORD_STATE_STUDYED):n.wordElMark(o,document.App.WORD_STATE.WORD_STATE_UNKNOWN),t.appendChild(o)}),o.appendChild(t)}),r.appendChild(o)}),t()}})}},{key:"onTextClick",value:function(e){var n=this;if(e.target.classList.contains("read-word")){var t=e.target.innerHTML;document.App.Component.Loadmask.show(document.App.localize("Загрузка перевода...")),document.App.getWordTranslate(t).then(function(e){document.App.Component.Loadmask.hide(),Pe.show({word:t,translate:e,onStudy:function(){document.App.wordStudyAdd(t),n.wordsMark(t,document.App.WORD_STATE.WORD_STATE_STUDY)},onStudied:function(){document.App.WordStudyedAdd(t),n.wordsMark(t,document.App.WORD_STATE.WORD_STATE_STUDYED)}})}).catch(function(e){o.querySelector(".translate").innerHTML="???",document.Helper.Log.addDebug(e),o.classList.add("hidden"),document.App.Component.WinMsg.show({title:document.App.localize("Ошибка!"),message:e instanceof Error?e.message:document.App.localize("Не удалось получить перевод слова")}),document.App.Component.Loadmask.hide()});var o=document.getElementById("win-word-actions");o.classList.add("hidden"),o.querySelector(".word").innerHTML=e.target.innerHTML,o.querySelector(".translate").innerHTML="...",o.classList.remove("hidden")}}},{key:"wordElMark",value:function(e,n){switch(e.classList.remove("read-word-unknown"),e.classList.remove("read-word-study"),e.classList.remove("read-word-studied"),n){case document.App.WORD_STATE.WORD_STATE_STUDY:e.classList.add("read-word-study");break;case document.App.WORD_STATE.WORD_STATE_STUDYED:e.classList.add("read-word-studied");break;case document.App.WORD_STATE.WORD_STATE_UNKNOWN:e.classList.add("read-word-unknown")}}},{key:"wordsMark",value:function(e,n){var t=this;document.Helper.isArray(e)||(e=[e]),e.forEach(function(e){var o="word-hash-"+document.App.getWordHash(e);De.el.querySelectorAll("."+o).forEach(function(e){t.wordElMark(e,n)})})}}],(t=null)&&Ie(n.prototype,t),o&&Ie(n,o),e}();o(310),o(312);function Me(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var We={elTbody:void 0,elTplTr:void 0,rowStruct:{word:void 0,translate:void 0,isStudy:void 0},rows:[],countPerPage:15,currentPage:1,totalPages:0,elGrid:void 0},He=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"init",value:function(e){We.elGrid=e,We.elGrid.querySelector(".study-bbar-btn-next").addEventListener("click",this.onBbarBtnNextClick.bind(this)),We.elGrid.querySelector(".study-bbar-btn-prev").addEventListener("click",this.onBbarBtnPrevClick.bind(this)),We.elGrid.querySelector(".study-bbar-gotopage-button").addEventListener("click",this.onBbarBtnGotopageClick.bind(this)),We.elTbody=We.elGrid.querySelector("table>tbody"),We.elTplTr=We.elTbody.querySelector("tr.tpl"),We.elTplTr.classList.remove("tpl")}},{key:"_loadData",value:function(){var e=this;return new Promise(function(n,t){document.App.Idb.WordsStudy.getCountForLang(document.App.langStudy).then(function(e){We.totalPages=Math.ceil(e/We.countPerPage)}).then(function(){return e._loadDataTable()}).then(function(){n()})})}},{key:"onBbarBtnNextClick",value:function(e){var n=this;We.currentPage>=We.totalPages||(++We.currentPage,this._loadDataTable().then(function(){n.display()}))}},{key:"_loadDataTable",value:function(){return We.rows=[],new Promise(function(e,n){document.App.Idb.WordsStudy.getAllAsObject(document.App.langStudy,{from:(We.currentPage-1)*We.countPerPage,to:We.currentPage*We.countPerPage-1}).then(function(e){var n=[];for(var t in e){n.push(t);var o=Object.assign({},We.rowStruct);o.word=t,o.isStudy=e[t].isStudy,We.rows.push(o)}return document.App.getWordsTranslate(n)}).then(function(n){n.forEach(function(e){document.Helper.Obj.getObjectFromArray(We.rows,"word",e.word).translate=e.translate}),e()}).catch(function(e){document.Helper.Log.addDebug(e),n(e)})})}},{key:"onBbarBtnPrevClick",value:function(e){var n=this;We.currentPage<=1||(--We.currentPage,this._loadDataTable().then(function(){n.display()}))}},{key:"onBbarBtnGotopageClick",value:function(e){var n=this,t=We.elGrid.querySelector(".study-bbar-gotopage-value").value;if(t=parseInt(t),!document.Helper.isNumber(t)||t<1||t>We.totalPages)document.App.Component.WinMsg.show({title:document.App.localize("Уведомление"),message:document.App.localize("Номер страницы вне допустимого диапазона")});else{var o=We.currentPage;We.currentPage=t,this.reload().then(function(){n.display()}).catch(function(){We.currentPage=o})}}},{key:"reload",value:function(){var e=this;return new Promise(function(n,t){e._loadData().then(function(){e.display(),n()}).catch(function(){t()})})}},{key:"display",value:function(){We.elGrid.querySelector(".study-bbar-page-value").innerHTML=We.currentPage,We.elGrid.querySelector(".study-bbar-page-total-value").innerHTML=We.totalPages,We.elTbody.innerHTML="";var e=function(e){var t=We.elTplTr.cloneNode(!0);if(t.classList.remove("tpl"),t.querySelector(".study-td-index").innerHTML=(We.currentPage-1)*We.countPerPage+n+1,document.Helper.isObject(e)){t.querySelector(".study-td-word").innerHTML=e.word,t.querySelector(".study-td-translate").innerHTML=e.translate;var o=t.querySelector(".study-td-is-study>i");e.isStudy===document.App.Idb.TRUE?(o.classList.add("fas"),o.classList.add("fa-plus-circle"),o.classList.add("is-study-true")):(o.classList.add("fas"),o.classList.add("fa-minus-circle"),o.classList.add("is-study-false"))}else t.classList.add("empty");We.elTbody.appendChild(t)},n=0;for(We.rows.forEach(function(t){e(t),++n});n<We.countPerPage;++n)e()}}],(t=null)&&Me(n.prototype,t),o&&Me(n,o),e}();function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _e(e,n){return!n||"object"!==xe(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function Re(e){return(Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ze(e,n){return(ze=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var Be=function(e){function n(){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),_e(this,Re(n).apply(this,arguments))}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&ze(e,n)}(n,U),n}();function Ne(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var qe={wordsTranslate:[],wordsStudy:[],wordsStudyProgress:{tplItem:{isMemorized:!1,cntCorrect:0,cntWrong:0},algLang1ToLang2:[],algLang2ToLang1:[]},defaults:{cntWordForStudy:6,cntCorrectForPass:3},elStudy:void 0},Fe=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"init",value:function(){qe.elStudy=document.getElementById("study"),qe.elStudy.querySelector(".study-panel-start").querySelector('input[name="cntToStudy"]').value=qe.defaults.cntWordForStudy,qe.elStudy.querySelector(".study-button-start").addEventListener("click",this.onButtonStartClick.bind(this)),He.init(qe.elStudy.querySelector(".study-words-grid"))}},{key:"display",value:function(){He.reload().catch(function(e){document.Helper.Log.addDebug(e)})}},{key:"onButtonStartClick",value:function(e){var n=this,t=qe.elStudy.querySelector(".study-panel-start").querySelector('input[name="cntToStudy"]').value;t=parseInt(t),!document.Helper.isNumber(t)||t<1?document.App.Component.WinMsg.show({title:document.App.localize("Уведомление."),message:document.App.localize("Недостаточно слов для изучения")}):(document.App.Component.Loadmask.show(document.App.localize("Получение списка слов для изучения...")),document.App.Idb.WordsStudy.getForStudy(document.App.langStudy,t).then(function(e){if(document.App.Component.Loadmask.hide(),e.length<1)document.App.Component.WinMsg.show({title:document.App.localize("Уведомление."),message:document.App.localize('Недостаточно слов для изучения.<br>Следует добавить слова в разделе "Чтение"')});else{qe.wordsStudy=e;var t=[];qe.wordsStudy.forEach(function(e){t.push(e.word)}),document.App.getWordsTranslate(t).then(function(e){qe.wordsTranslate=e,n.doStudy()})}}).catch(function(e){document.Helper.Log.addDebug(e)}))}},{key:"clearProgress",value:function(){qe.wordsStudyProgress.algLang1ToLang2=[],qe.wordsStudyProgress.algLang2ToLang1=[],qe.wordsStudy.forEach(function(e,n){qe.wordsStudyProgress.algLang1ToLang2[n]=Object.assign({},qe.wordsStudyProgress.tplItem),qe.wordsStudyProgress.algLang2ToLang1[n]=Object.assign({},qe.wordsStudyProgress.tplItem)})}},{key:"doStudy",value:function(){var e=this;this.clearProgress(),this.doStudyLang1ToLang2().then(function(){return e.updateIdbWordStudy()}).then(function(){return e.doStudyLang2ToLang1()}).then(function(){return e.updateIdbWordStudy()}).then(function(){document.App.Component.WinWordCard.hide(),document.App.Component.WinMsg.show({title:document.App.localize("Уведомление."),message:document.App.localize("Все слова изучены")}),document.App.Component.Statistic.display(),He.reload(),document.App.Component.Read.wordsMark(document.Helper.Obj.getFieldsAsArray(qe.wordsStudy,"word"),document.App.WORD_STATE.WORD_STATE_STUDYED)}).catch(function(e){document.App.Component.WinWordCard.hide(),document.App.Component.Read.wordsMark(document.Helper.Obj.getFieldsAsArray(qe.wordsStudy,"word"),document.App.WORD_STATE.WORD_STATE_STUDY),e instanceof U?document.App.Component.WinMsg.show({title:document.App.localize("Уведомление"),message:e.message,textButtonClose:document.App.localize("Ок")}):document.App.Component.WinMsg.show({title:'<span style="color: red;">'+document.App.localize("Ошибка.")+"</span>",message:e,textButtonClose:document.App.localize("Ок")})})}},{key:"updateIdbWordStudy",value:function(){return Promise.all((e=[],qe.wordsStudy.forEach(function(n,t){var o=qe.wordsStudyProgress.algLang1ToLang2[t],r=qe.wordsStudyProgress.algLang2ToLang1[t],a={isStudy:document.App.Idb.TRUE,isFinishedLang1ToLang2:document.App.Idb.getBool(o.isMemorized||o.cntCorrect-o.cntWrong>=qe.defaults.cntCorrectForPass),isFinishedLang2ToLang1:document.App.Idb.getBool(r.isMemorized||r.cntCorrect-r.cntWrong>=qe.defaults.cntCorrectForPass)};a.isFinishedLang1ToLang2&&a.isFinishedLang2ToLang1&&(a.isStudy=document.App.Idb.FALSE),e.push(document.App.Idb.WordsStudy.put(document.App.langStudy,n.word,a))}),e));var e}},{key:"doStudyLang1ToLang2",value:function(){var e,n=this,t=[],o=0;return qe.wordsTranslate.forEach(function(e){t.push(e.word)}),new Promise(function(r,a){(function n(r,a){var i=this;e=function(){var e={wordIndex:void 0,word:void 0,answer:void 0},n=[];if(qe.wordsStudy.forEach(function(e,t){var o=qe.wordsStudyProgress.algLang1ToLang2[t];o.isMemorized||o.cntCorrect-o.cntWrong<qe.defaults.cntCorrectForPass&&n.push(t)}),n.length<1)return;var t=Math.floor(Math.random()*n.length);e.wordIndex=n[t],e.answer=qe.wordsStudy[e.wordIndex].word;var o=document.Helper.Obj.getObjectFromArray(qe.wordsTranslate,"word",e.answer);return void 0!==o?(e.word=o.translate,e):void document.App.Component.WinMsg.show({title:document.App.localize("Ошибка!"),message:document.App.localize("Не удалось извлечь перевод из кеша.")})}.call(this);if(!document.Helper.isDefined(e))return document.App.Component.WinWordCard.hide(),r();document.App.Component.WinWordCard.update({title:document.App.localize("Изучение слов с родного языка на целевой"),word:e.word,answers:t,correctAnswer:e.answer});0==o&&document.App.Component.WinWordCard.show({onMemorized:function(){qe.wordsStudyProgress.algLang1ToLang2[e.wordIndex].isMemorized=!0,n.call(i,r,a)},onCancel:function(){a(new Be(document.App.localize("Пользователь отменил изучение")))},onAnswerCorrect:function(){++qe.wordsStudyProgress.algLang1ToLang2[e.wordIndex].cntCorrect,n.call(i,r,a)},onAnswerWrong:function(){++qe.wordsStudyProgress.algLang1ToLang2[e.wordIndex].cntWrong,n.call(i,r,a)}});o++}).call(n,r,a)})}},{key:"doStudyLang2ToLang1",value:function(){var e,n=this,t=[],o=0;return qe.wordsTranslate.forEach(function(e){t.push(e.translate)}),new Promise(function(r,a){(function n(r,a){var i=this;e=function(){var e={wordIndex:void 0,word:void 0,answer:void 0},n=[];if(qe.wordsStudy.forEach(function(e,t){var o=qe.wordsStudyProgress.algLang2ToLang1[t];o.isMemorized||o.cntCorrect-o.cntWrong<qe.defaults.cntCorrectForPass&&n.push(t)}),n.length<1)return;var t=Math.floor(Math.random()*n.length);e.wordIndex=n[t];var o=document.Helper.Obj.getObjectFromArray(qe.wordsTranslate,"word",qe.wordsStudy[e.wordIndex].word);if(!document.Helper.isDefined(o))return void document.App.Component.WinMsg.show({title:document.App.localize("Ошибка!"),message:document.App.localize("Не удалось извлечь перевод из кеша.")});return e.word=o.word,e.answer=o.translate,e}.call(this);if(!document.Helper.isDefined(e))return document.App.Component.WinWordCard.hide(),r();document.App.Component.WinWordCard.update({title:document.App.localize("Изучение слов с целевого языка на родной"),word:e.word,answers:t,correctAnswer:e.answer});0==o&&document.App.Component.WinWordCard.show({onMemorized:function(){qe.wordsStudyProgress.algLang2ToLang1[e.wordIndex].isMemorized=!0,n.call(i,r,a)},onCancel:function(){a(new Be(document.App.localize("Пользователь отменил изучение")))},onAnswerCorrect:function(){++qe.wordsStudyProgress.algLang2ToLang1[e.wordIndex].cntCorrect,n.call(i,r,a)},onAnswerWrong:function(){++qe.wordsStudyProgress.algLang2ToLang1[e.wordIndex].cntWrong,n.call(i,r,a)}});o++}).call(n,r,a)})}}],(t=null)&&Ne(n.prototype,t),o&&Ne(n,o),e}();o(314);function Ue(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ge={showedAt:void 0,minTimeShow:500,timerHide:void 0},Xe=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getEl",value:function(){return document.getElementById("loadmask")}},{key:"show",value:function(e){Ge.timerHide&&clearTimeout(Ge.timerHide),Ge.showedAt=Date.now(),e&&this.setMessage(e),this.getEl().classList.remove("hidden")}},{key:"hide",value:function(){var e=this,n=Date.now()-Ge.showedAt;if(n>=Ge.minTimeShow)this.getEl().classList.add("hidden"),Ge.timerHide&&clearTimeout(Ge.timerHide);else{var t=Ge.minTimeShow-n;Ge.timerHide=setTimeout(function(){e.hide()},t>0?t:50)}}},{key:"setMessage",value:function(e){this.getEl().querySelector(".loadmask-message").innerHTML=e}}],(t=null)&&Ue(n.prototype,t),o&&Ue(n,o),e}();o(316);function Ke(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ye="Сообщение",Ve="...",Je="Ok",Qe=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getEl",value:function(){return document.getElementById("win-msg")}},{key:"show",value:function(e){var n=this;e=e||{},e=document.Helper.Obj.replaceMembers({title:document.App.localize(Ye),message:document.App.localize(Ve),textButtonClose:document.App.localize(Je),callback:document.Helper.emptyFn},e),this.getEl().querySelector(".win-msg-title").innerHTML=e.title,this.getEl().querySelector(".win-msg-text").innerHTML=e.message,this.getEl().querySelector(".win-msg-button-close").innerHTML=e.textButtonClose,this.getEl().classList.remove("hidden"),document.querySelector("#modal-background").classList.remove("hidden"),this.getEl().querySelector(".win-msg-button-close").onclick=function(){n.getEl().classList.add("hidden"),document.querySelector("#modal-background").classList.add("hidden"),e.callback()}}}],(t=null)&&Ke(n.prototype,t),o&&Ke(n,o),e}();o(318);function $e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ze={correctAnswer:void 0,elTplAnswer:void 0,defaults:{title:"Изучение слова"}},en=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"getEl",value:function(){return document.getElementById("win-word-card")}},{key:"show",value:function(e){return document.Helper.isObject(e)?document.Helper.isFunction(e.onCancel)?document.Helper.isFunction(e.onMemorized)?document.Helper.isFunction(e.onAnswerCorrect)?document.Helper.isFunction(e.onAnswerWrong)||this.throwError('show/Не передан параметр "onAnswerWrong"'):this.throwError('show/Не передан параметр "onAnswerCorrect"'):this.throwError('show/Не передан параметр "onMemorized"'):this.throwError('show/Не передан параметр "onCancel"'):this.throwError("show/Параметры не переданы"),this.getEl().querySelector(".win-word-card-window").onclick=function(n){if(n.preventDefault(),n.target.classList.contains("win-word-card-btn-cancel"))e.onCancel();else if(n.target.classList.contains("win-word-card-btn-memorized"))e.onMemorized();else if(n.target.classList.contains("win-word-card-answer"))if(n.target.innerHTML===Ze.correctAnswer)n.target.classList.add("correct"),setTimeout(function(){n.target.classList.remove("correct"),e.onAnswerCorrect()},700);else{n.target.classList.add("wrong");var t=n.target.innerHTML;n.target.innerHTML=Ze.correctAnswer,setTimeout(function(){n.target.classList.remove("wrong"),n.target.innerHTML=t,e.onAnswerWrong()},1500)}},this.getEl().classList.remove("hidden"),document.querySelector("#modal-background").classList.remove("hidden"),this}},{key:"hide",value:function(){return this.getEl().classList.add("hidden"),document.querySelector("#modal-background").classList.add("hidden"),this}},{key:"update",value:function(e){document.Helper.isObject(e)?document.Helper.isString(e.word)?document.Helper.isArray(e.answers)?document.Helper.isString(e.correctAnswer)||this.throwError('update/Не передан параметр "correctAnswer"'):this.throwError('update/Не передан параметр "answers"'):this.throwError('update/Не передан параметр "word"'):this.throwError("update/Не переданы параметы"),Ze.correctAnswer=e.correctAnswer;var n=this.getEl().querySelector(".win-word-card-answers");return Ze.elTplAnswer||(Ze.elTplAnswer=this.getEl().querySelector(".tpl.win-word-card-answer").cloneNode(!0),this.getEl().querySelector(".tpl.win-word-card-answer").remove(),Ze.elTplAnswer.classList.remove("tpl")),this.getEl().querySelector(".win-word-card-title").innerHTML=e.title||document.App.localize(Ze.defaults.title),this.getEl().querySelector(".win-word-card-word").innerHTML=e.word,n.innerHTML="",e.answers.forEach(function(e){var t=Ze.elTplAnswer.cloneNode(!0);t.innerHTML=e,n.appendChild(t)}),this}}],(t=null)&&$e(n.prototype,t),o&&$e(n,o),e}();function nn(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var tn=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"init",value:function(){j.init(),H.init(),Ee.init(),je.init(),Fe.init()}},{key:"App",get:function(){return dn}},{key:"Nav",get:function(){return j}},{key:"Setlang",get:function(){return H}},{key:"Statistic",get:function(){return _}},{key:"Library",get:function(){return Ee}},{key:"Read",get:function(){return je}},{key:"Study",get:function(){return Fe}},{key:"Loadmask",get:function(){return Xe}},{key:"WinMsg",get:function(){return Qe}},{key:"WinWordActions",get:function(){return Pe}},{key:"WinWordCard",get:function(){return en}}],(t=null)&&nn(n.prototype,t),o&&nn(n,o),e}();function on(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var rn=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"App",get:function(){return Q}},{key:"User",get:function(){return U}}],(t=null)&&on(n.prototype,t),o&&on(n,o),e}();function an(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var un={_loadedLang:{},_translates:{},_unknownTranslates:{}},cn=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"load",value:function(e){try{if(!P.isDefined(e))return!1;if(e in un._loadedLang&&!un._loadedLang[e])return!1;if(e in un._translates)return!0;var n=P.Ajax.getXhr();if(n.open("GET","/data/localize/"+e+".json",!1),n.send(),200!=n.status)return un._loadedLang[e]=!1,!1;var t=JSON.parse(n.responseText);return un._translates[e]=t,un._loadedLang[e]=!0,!0}catch(n){return un._loadedLang[e]=!1,!1}}},{key:"get",value:function(e,n){if(!this.load(n))return this.addUnknownTranslate(e,n),e;if(e in un._translates[n]){var t=un._translates[n][e];return P.isNull(t)?e:t}return this.addUnknownTranslate(e,n),e}},{key:"addUnknownTranslate",value:function(e,n){n in un._unknownTranslates||(un._unknownTranslates[n]={}),un._unknownTranslates[n][e]="",console.log("translateMe/"+n+"/",e)}}],(t=null)&&an(n.prototype,t),o&&an(n,o),e}();function ln(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var sn={WORD_STATE:{WORD_STATE_STUDY:"WORD_STATE_STUDY",WORD_STATE_STUDYED:"WORD_STATE_STUDYES",WORD_STATE_UNKNOWN:"WORD_STATE_UNKNOWN"},selectibleTags:["SELECT","INPUT"],appEnv:void 0,langGui:void 0,langStudy:void 0,book:{}},dn=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,o;return n=e,o=[{key:"run",value:function(){document.body.onmousedown=function(e){return sn.selectibleTags.indexOf(e.target.tagName)>=0},document.body.onselectstart=function(){return sn.selectibleTags.indexOf(event.target.tagName)>=0},tn.init(),e.Component.Loadmask.show("..."),new Promise(function(n,t){e.loadEnv().then(function(){n()}).catch(function(e){t(e)})}).then(function(){var n={lastSession:void 0,lastBook:void 0,isBookReaded:!1};return new Promise(function(t,o){e.Idb.KeyVal.LastSession.get().then(function(e){n.lastSession=e,t(n)})})}).then(function(n){return new Promise(function(t,o){P.isObject(n.lastSession)?(e.langGui=n.lastSession.langGui,e.langStudy=n.lastSession.langStudy):(e.langGui=sn.appEnv.defaults.langGui,e.langStudy=sn.appEnv.defaults.langStudy),e.localizeGui(),t(n)})}).then(function(n){return new Promise(function(t,o){e.Component.Loadmask.show(e.localize("Загрузка...")),e.Component.Statistic.display().then(function(){P.isObject(n.lastSession)&&P.isString(n.lastSession.bookHash)?e.Idb.Books.getByHash(n.lastSession.bookHash).then(function(e){n.lastBook=e,t(n)}).catch(function(){t(n)}):t(n)}).catch(function(e){P.Log.addDebug("Не удалось обновить статистику изучения слов"),t(n)})})}).then(function(n){return new Promise(function(t,o){n.lastBook&&n.lastBook.content?e.bookToRead(n.lastBook.content,!1).then(function(){n.isBookReaded=!0,t(n)}).catch(function(e){o(e)}):t(n)})}).then(function(n){e.Component.Loadmask.hide(),n.isBookReaded?e.Component.Nav.go2section("read"):n.lastSession?e.Component.Nav.go2section("library"):e.Component.Nav.go2section("setlang")}).catch(function(n){P.Log.addDebug(n),n instanceof U?e.Component.WinMsg.show({title:e.localize("Уведомление."),message:n.message,callback:function(){e.Component.Nav.go2section("setlang")}}):e.Component.Nav.go2section("setlang")})}},{key:"loadEnv",value:function(){return new Promise(function(e,n){var t=P.Ajax.getXhr();t.open("GET","/data/app-env.json"),t.send(),t.addEventListener("readystatechange",function(){if(4===t.readyState){var n=JSON.parse(t.responseText);sn.appEnv=n,e()}})})}},{key:"bookToReadByHash",value:function(n){var t;return e.Component.Loadmask.show(e.localize("Извлечение книги...")),new Promise(function(o,r){e.Idb.Books.getByHash(n).then(function(n){return t=n,e.bookToRead(n.content,!1)}).then(function(){return e.Idb.KeyVal.LastSession.put({langGui:e.langGui,langStudy:e.langStudy,bookHash:t.hash,bookPosition:0}).then(function(){e.Component.Loadmask.hide(),o()})}).catch(function(e){r(e)})})}},{key:"bookToRead",value:function(n,t){return new Promise(function(o,r){var a;t=!P.isDefined(t)||t,e.Component.Loadmask.show(e.localize("Конвертация книги..."));try{a=P.Fb2.getBookFromText(n)}catch(n){P.Log.addDebug(n),r(new e.Errors.User(e.localize("Не удалось преобразовать книгу")))}if(e.langStudy!==sn.appEnv.fb2.languages[a.lang])return e.Component.Loadmask.hide(),void r(new U(e.localize("Язык книги не соответствует изучаемому.")));e.Component.Loadmask.show(e.localize("Формирование области чтения...")),e.Component.Read.displayBook(a).then(function(){e.Component.Loadmask.hide(),t?e.Idb.Books.add(e.langStudy,a.title.join("/"),a.image,n).then(function(n){e.Idb.KeyVal.LastSession.put({bookHash:n.hash,bookPosition:0}).then(function(){o()})}).catch(function(n){e.Component.Loadmask.hide(),P.Log.addDebug(n),e.Component.WinMsg.show({title:'<span style="color: red">'+e.localize("Ошибка!")+"</span>",message:e.localize("Не удалось добавить книгу в библиотеку.")}),r()}):o()}).catch(function(n){e.Component.Loadmask.hide(),r(n)})})}},{key:"getWordTranslate",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(o,r){e.Idb.WordsTranslate.get(e.langStudy,e.langGui,n).then(function(a){P.isObject(a)?o(t?a:a.translate):P.Google.translate(sn.appEnv.google.languages[e.langGui],n).then(function(a){if(P.isObject(a)){var i=P.Google.getTranslateConverted(a);P.isEmpty(i.translate)?r(new Error("Не удалось получить перевод от Google")):(t||o(i.translate),e.Idb.WordsTranslate.put(e.langStudy,e.langGui,n,i.translate,i.score).then(function(){return e.Idb.WordsTranslate.get(e.langStudy,e.langGui,n)}).then(function(e){t&&(P.isObject(e)?o(e):r(new Error("Неудалось извлечь слово из БД после сохранения")))}))}else r()})})})}},{key:"getWordsTranslate",value:function(n){var t;return Promise.all((t=[],n.forEach(function(n){t.push(e.getWordTranslate(n,!0))}),t)).then(function(e){return P.isArray(e)?e:new Error("Не удалось получить перевод для списка слов")})}},{key:"wordStudyAdd",value:function(n){e.Idb.WordsStudy.put(e.langStudy,n,{isStudy:e.Idb.TRUE}).then(function(n){e.Component.Statistic.display()}).catch(function(e){P.Log.addDebug(e)})}},{key:"WordStudyedAdd",value:function(n){e.Idb.WordsStudy.put(e.langStudy,n,{isStudy:e.Idb.FALSE}).then(function(n){e.Component.Statistic.display()}).catch(function(e){P.Log.addDebug(e)})}},{key:"getWordHash",value:function(e){return P.Hash.hashCode(e.toLowerCase())}},{key:"localize",value:function(n){return e.Localize.get(n,e.langGui)}},{key:"localizeGui",value:function(){var n=document.querySelectorAll(".need-translate");(n=[].slice.call(n)).forEach(function(n){var t=n.getAttribute("data-localize-key");t=t||n.innerHTML;var o=e.Localize.get(t,e.langGui);n.innerHTML=o,n.setAttribute("data-localize-key",t)})}},{key:"Helper",get:function(){return P}},{key:"Component",get:function(){return tn}},{key:"Errors",get:function(){return rn}},{key:"Idb",get:function(){return ve}},{key:"Localize",get:function(){return cn}},{key:"WORD_STATE",get:function(){return sn.WORD_STATE}},{key:"appEnv",get:function(){return sn.appEnv}}],(t=null)&&ln(n.prototype,t),o&&ln(n,o),e}();document.Helper=P,document.App=dn,dn.run()}});
//# sourceMappingURL=app.js.map